---
Course: APAN 5205 Electronics metadata cleaning
Title: Data Preparation for the main Electronics dataset
Group: Purrfect
Members: Drashti Shah, Cenrara Widi, Jaejae Zhang
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##STEP 1 Data Import

#Since the metadata file is huge, we split the file where each file only consists of 50,000 JSON lines. The splitting process generated 16 files. Therefore, we assigned the path for each file to a variable.

```{r echo=TRUE}
file1 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_aa"
file2 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ab"
file3 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ac"
file4 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ad"
file5 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ae"
file6 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_af"
file7 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ag"
file8 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ah"
file9 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ai"
file10 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_aj"
file11 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ak"
file12 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_al"
file13 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_am"
file14 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_an"
file15 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ao"
file16 <- "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/Split Data/meta_ap"
```

#Load all the split metadata files into data frames.

```{r echo=TRUE}
library(jsonlite)
meta1 <- stream_in(file(file1))
meta2 <- stream_in(file(file2))
meta3 <- stream_in(file(file3))
meta4 <- stream_in(file(file4))
meta5 <- stream_in(file(file5))
meta6 <- stream_in(file(file6))
meta7 <- stream_in(file(file7))
meta8 <- stream_in(file(file8))
meta9 <- stream_in(file(file9))
meta10 <- stream_in(file(file10))
meta11 <- stream_in(file(file11))
meta12 <- stream_in(file(file12))
meta13 <- stream_in(file(file13))
meta14 <- stream_in(file(file14))
meta15 <- stream_in(file(file15))
meta16 <- stream_in(file(file16))
```

Drop columns that will not be needed for analysis and only include relevant columns such as ASIN, product title or name, and main product category.

```{r echo=TRUE}
meta1 <- meta1[, c("asin", "title", "main_cat")]
meta2 <- meta2[, c("asin", "title", "main_cat")]
meta3 <- meta3[, c("asin", "title", "main_cat")]
meta4 <- meta4[, c("asin", "title", "main_cat")]
meta5 <- meta5[, c("asin", "title", "main_cat")]
meta6 <- meta6[, c("asin", "title", "main_cat")]
meta7 <- meta7[, c("asin", "title", "main_cat")]
meta8 <- meta8[, c("asin", "title", "main_cat")]
meta9 <- meta9[, c("asin", "title", "main_cat")]
meta10 <- meta10[, c("asin", "title", "main_cat")]
meta11 <- meta11[, c("asin", "title", "main_cat")]
meta12 <- meta12[, c("asin", "title", "main_cat")]
meta13 <- meta13[, c("asin", "title", "main_cat")]
meta14 <- meta14[, c("asin", "title", "main_cat")]
meta15 <- meta15[, c("asin", "title", "main_cat")]
meta16 <- meta16[, c("asin", "title", "main_cat")]
```

Combine all data frames into one

```{r echo=TRUE}
meta_data <- rbind(meta1, meta2, meta3, meta4, meta5, meta6, meta7, meta8, meta9, meta10, meta11, meta12, meta13, meta14,
                   meta15, meta16)
```

##STEP 2- Data Cleaning

#Remove duplicates of Product ID-asin column

```{r echo=TRUE}
library(dplyr)
meta_data <- meta_data %>%
  distinct(asin, .keep_all = TRUE)
```

#Clean up data by removing punctuations, tabs, blank spaces, special characters, and non-graphical characters.

```{r echo=TRUE}
library(stringr)
meta_data <- meta_data %>%
  mutate(title = gsub("[[:punct:]]", "", title), #Remove punctuation
         title = gsub("[ |\t]{2,}", "", title), #Remove tab
         title = gsub("^ ", "", title), #Remove blank space in the beginning
         title = gsub(" $", "", title), #Remove blank space at the end
         title = gsub("[^[:graph:]]", " ", title), #Remove non-graphical characters
         title = gsub("[^[:alnum:]]", " ", title), #Remove special characters
         title = gsub("[^a-zA-Z0-9]", " ", title), #Remove other special characters
         title = gsub("amp", "and", title)) %>% #Replace amp with and
  mutate(main_cat = gsub("[[:punct:]]", "", main_cat),
         main_cat = gsub("[ |\t]{2,}", "", main_cat),
         main_cat = gsub("^ ", "", main_cat), 
         main_cat = gsub(" $", "", main_cat),
         main_cat = gsub("[^[:graph:]]", " ", main_cat),
         main_cat = gsub("[^[:alnum:]]", " ", main_cat),
         main_cat = gsub("[^a-zA-Z0-9]", " ", main_cat),
         main_cat = gsub("amp", "and", main_cat))
```

#More clean up specifically for the main_cat column to replace empty values with NAs and combine repetitive category values.

```{r echo=TRUE}
meta_data <- meta_data %>%
  mutate(main_cat = gsub("Arts CraftsSewing", "Arts Crafts and Sewing", main_cat),
         main_cat = gsub("CameraPhoto", "Camera and Photo", main_cat),
         main_cat = gsub("Cell PhonesAccessories", "Cell Phones and Accessories", main_cat),
         main_cat = gsub("GPSNavigation", "GPS and Navigation", main_cat),
         main_cat = gsub("HealthPersonal Care", "Health and Personal Care", main_cat),
         main_cat = gsub("Home AudioTheater", "Home Audio and Theater", main_cat),
         main_cat = gsub("IndustrialScientific", "Industrial and Scientific", main_cat),
         main_cat = gsub("MoviesTV", "Movies and TV", main_cat),
         main_cat = gsub("Portable AudioAccessories", "Portable Audio and Accessories", main_cat),
         main_cat = gsub("SportsOutdoors", "Sports and Outdoors", main_cat),
         main_cat = gsub("ToolsHome Improvement", "Tools and Home Improvement", main_cat),
         main_cat = gsub("ToysGames", "Toys and Games", main_cat),
         main_cat = gsub(".*srchttps", NA, main_cat)) #Replace text pattern with NA

meta_data$main_cat[meta_data$main_cat == ""] <- NA #Replace empty category with NA
```

##STEP 3- Write the clean data into a csv file.

```{r echo=TRUE}
write.csv(meta_data, "/Users/cenrawidi/Documents/Columbia University/Classes/2021 Spring/APAN 5205/Group Project/meta_electronics.csv", row.names = FALSE)
```

